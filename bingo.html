<html>


<head>
    <meta http-equiv="refresh" content="5">
    <!-- <link rel="stylesheet" href="css/bootstrap/3.3.6/bootstrap.min.css" type="text/css" media="screen" /> -->

    <link rel="stylesheet" href="css/bootstrap/5.0.0-beta3/bootstrap.min.css" type="text/css" media="screen" />

    <style type="text/css">
        .button {
            width: 100%;
            height: 100%;
        }

        .container_img {
            height: 100%;
            width: 100%;
            /* object-fit: cover; */
        }
    </style>
</head>



<body>
    <div class="container-fluid">
        <div class="row" style="height:30%;">
            <!-- <img class="container_img" src="JPGS/bingo/banner.jpg"></img> -->
        </div>
        <div class="row" style="height:35%;">
            <div class="col-8 bg-info">
                <div id="hisNums" classm="text-justify" style="font-size:3rem">Records: </div>
            </div>

            <div class="col">
                <div calss="row bg-primary  fs-1 text-center" style="height:50%;">
                    <label class="flex-fill align-middle " id="currentNum"
                        style="max-width:100%; margin: 0;padding: 0;font-size:10rem">
                        C
                    </label>
                </div>
                <div class="row bg-warning fs-1 text-center" style="height:50%;">
                    <label class="flex-fill align-middle " id="count"
                        style="max-width:100%; margin: 0;padding: 0;font-size:10rem">
                        N
                    </label>
                </div>

            </div>

        </div>

        <div class="row" style="height:35%;">
            <div class="col-6 bg-success">
                <div class="button" onclick="startG()" style="font-size:12rem">Start</div>
            </div>
            <div class="col-6 bg-danger">
                <div class="button text-justify" id="pauseButton" style="font-size:8rem" onclick="pauseOrResume()">
                    Pause / Resume
                </div>
            </div>
        </div>

    </div>
</body>


<script>


    var callTimeOut;
    var countTimeOut;

    var callStart;
    var countStart;

    const callDelay = 8000;
    const countDelay = 1000;

    var callNumber;
    var countNumber;

    var callRemaining;
    var countRemaining;

    var pauseFlag = 0;

    const audio = new Audio();

    var count = document.getElementById("count");
    var currentNum = document.getElementById("currentNum");
    var hisNums = document.getElementById("hisNums");

    var list = new Array(75);

    async function startG() {

        hisNums.innerText = "Records: ";

        audio.play();
        audio.src = 'audio/count_down_4321.wav';
        audio.load();

        count.innerText = "C";
        currentNum.innerText = "N";

        for (var i = 0; i < 75; i++) {
            list[i] = i + 1;
        }


        shuffleArray(list);
        console.log(list);

        callNumber = 75;
        call(75);


    }

    function call(number) {

        callStart = Date.now();
        callRemaining = callDelay;
        callNumber = number;

        callTimeOut = setTimeout(() => {

            if (number == 0) {
                currentNum.innerText = "Game End";
            } else {
                console.log(list[parseInt(number - 1 + "")]);
                currentNum.innerText = list[number - 1];
                hisNums.innerText = hisNums.innerText + " " + list[number - 1];

                audio.play();
                count.innerText = 3;
                countNumber = 2;
                countDown(2);
                call(number - 1);
            }

        }, Math.min(callRemaining, callDelay));

    }

    function countDown(number) {
        countStart = Date.now();
        countRemaining = countDelay;
        countNumber = number;

        countTimeOut = setTimeout(() => {

            if (number == 0) {
                currentNum.innerText = "N";
                count.innerText = "C";
            } else {
                count.innerText = number;
                countDown(number - 1);
            }
        }, Math.min(countRemaining, countDelay));

    }


    function pauseOrResume() {

        var pauseButton = document.getElementById("pauseButton");


        if (pauseFlag == 0) {


            console.log(callNumber + " pause " + countNumber)
            callRemaining -= Date.now - callStart;

            window.clearTimeout(callTimeOut);

            if (countNumber > 0) {
                countRemaining -= Date.now - countStart;
                window.clearTimeout(countTimeOut);
            }


            pauseFlag = 1;
            pauseButton.innerText = "Resume";
        } else {
            console.log(callNumber + " resume " + countNumber)
            callStart = Date.now();
            // setTimeout(call(callNumber), callRemaining);
            call(callNumber);

            if (countNumber > 0) {
                countStart = Date.now();
                countDown(countNumber);
                // setTimeout(countDown(countNumber), countRemaining);
            }


            pauseFlag = 0;
            pauseButton.innerText = "Pause";

        }

    }


    function getRandomInt(max) {
        return Math.floor(Math.random() * max);
    }

    function shuffleArray(array) {

        for (var i = array.length - 1; i > 0; i--) {
            var j = getRandomInt(i + 1);
            temp = array[j];
            array[j] = array[i];
            array[i] = temp;
        }

    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }



</script>

</html>